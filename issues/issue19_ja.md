# 親子タスク機能の実装

## 概要

タスクを親タスクと子タスクに分解し、2階層の階層構造で管理する機能を実装します。親タスクの進捗は子タスクの見積もり時間ベースで自動計算されます。

## 変更内容

### 1. 親子タスクの階層構造
- 2階層（親→子）のみ対応
- 親タスクIDを子タスクに持たせる
- 自己参照型のデータ構造

### 2. 親タスクの進捗管理
- 子タスクの見積もり時間ベースで進捗を自動計算
- 進捗率 = (完了した子タスクの見積もり時間合計 / 全子タスクの見積もり時間合計) × 100%
- 進捗バーで視覚的に表示

### 3. 子タスクの表示
- 親タスクの下に折りたたみ可能で表示
- インデント表示
- 展開/折りたたみボタン

### 4. 親タスク削除時の処理
- 親タスクを削除する際、子タスクも一緒に削除
- 確認ダイアログを表示

## 技術的な実装

### バックエンド（Code.gs）

#### データ構造の変更
- スプレッドシートに「親タスクID」列を追加
- 親タスクIDが空なら親タスク、値があれば子タスク

#### 関数の追加・更新
- `createTaskRow()`: 親タスクIDを設定可能に
- `getTasksWithChildren()`: 親タスクと子タスクを階層構造で取得
- `calculateParentProgress(parentTaskId)`: 親タスクの進捗を計算
- `deleteTaskWithChildren(taskId)`: 親タスクと子タスクを削除

#### 進捗計算ロジック
```javascript
function calculateParentProgress(parentTaskId) {
  const children = getChildTasks(parentTaskId);
  const totalHours = children.reduce((sum, task) => sum + (task.estimatedHours || 0), 0);
  const completedHours = children
    .filter(task => task.status === '完了')
    .reduce((sum, task) => sum + (task.estimatedHours || 0), 0);
  return totalHours > 0 ? (completedHours / totalHours) * 100 : 0;
}
```

### フロントエンド（index.html）

#### 親子タスクの表示
- 親タスクに展開/折りたたみボタンを追加
- 子タスクをインデント表示
- 折りたたみ状態を保持

#### 進捗バーの表示
- 親タスクに進捗バーを表示
- 進捗率を数値で表示（例: "進捗: 13/23時間 (56%)"）

#### 子タスクの操作
- 子タスクの追加（手動）
- 子タスクの編集
- 子タスクの削除

## データ構造

### タスクシートの列（追加）

| 列番号 | 列名 | 説明 |
|--------|------|------|
| ... | ... | ... |
| 13 | 親タスクID | 親タスクのID（空なら親タスク、値があれば子タスク） |

### データ例

```
| ID | タイトル | ... | 親タスクID | 領域 | ステータス |
|----|---------|-----|-----------|------|-----------|
| 1  | 親タスクA| ... | (空)      | 今すぐ| 進行中    |
| 2  | 子タスク1| ... | 1         | 今すぐ| 完了      |
| 3  | 子タスク2| ... | 1         | 今すぐ| 未着手    |
```

## UI/UXの詳細

### 表示例
```
┌─ 今すぐやる ─────────────────────────┐
│                                        │
│  ▼ [親タスク] タスク管理ポータルの改修 │
│    進捗: 13/23時間 (56%)               │
│    ├─ [子タスク] 領域分け機能の実装    │
│    │  見積: 5時間 | 完了              │
│    ├─ [子タスク] 親子タスク機能の実装  │
│    │  見積: 8時間 | 完了              │
│    └─ [子タスク] Gemini連携の実装     │
│       見積: 10時間 | 未着手           │
│                                        │
└────────────────────────────────────────┘
```

## 注意事項

- 親タスクIDが存在するIDを参照しているか検証
- 親タスクを削除する際は確認ダイアログを表示
- 子タスクの領域は親タスクと同じ領域に表示（移動は個別に可能）


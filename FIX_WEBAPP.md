# Webアプリのエラー修正手順

## 現在のエラー

- `Cannot read properties of undefined (reading 'getSheetByName')`
- `tasks.filter is not a function`

## 原因

Webアプリとして実行する際に、スプレッドシートへのアクセス権限が正しく設定されていない可能性があります。

## 解決手順

### 1. Webアプリの設定を確認・更新

1. [GASエディタ](https://script.google.com/d/1OZNbk3v9kgRPDPvsLlaShtG1DhCfMCYdtpnXaRqbX1nqtKS_11ETpPQ_/edit) を開く
2. 「デプロイ」→「デプロイを管理」をクリック
3. 既存のWebアプリデプロイを選択して「編集」をクリック
4. **重要な設定を確認**：
   - **次のユーザーとして実行**: **「自分」** を選択（必須）
   - **アクセスできるユーザー**: 「自分」または「全員」
   - **バージョン**: 「新規」を選択（最新のコードを使用）
5. 「デプロイ」をクリック

### 2. 権限の再承認

1. GASエディタで「実行」→「initializeSpreadsheet」を選択
2. 「実行」ボタンをクリック
3. 権限承認画面が表示されたら：
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「タスク管理ポータル（安全ではないページ）に移動」をクリック
   - 「許可」をクリック

### 3. スプレッドシートの共有設定を確認

1. [スプレッドシート](https://docs.google.com/spreadsheets/d/1mB9nhSma1jiUOhjQpN2Ae9Ib8unc_Ixq6WAEY3geydU/edit) を開く
2. 「共有」ボタンをクリック
3. 自分のアカウント（`ariibu03@gmail.com`）が「編集者」または「所有者」として追加されていることを確認
4. 必要に応じて、自分のアカウントを追加

### 4. Webアプリの再読み込み

1. WebアプリのURLを開く
2. ブラウザのキャッシュをクリア：
   - Windows: `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`
3. または、シークレットモードで開く

### 5. ログの確認

エラーが続く場合：

1. GASエディタで「表示」→「ログ」を開く
2. Webアプリでタスクを追加しようとする
3. ログに表示されるエラーメッセージを確認
4. エラーメッセージを共有してください

## 確認事項チェックリスト

- [ ] Webアプリの「次のユーザーとして実行」が「自分」になっている
- [ ] Webアプリのバージョンが「新規」になっている
- [ ] `initializeSpreadsheet()` を実行して権限を承認した
- [ ] スプレッドシートに自分のアカウントがアクセス権限を持っている
- [ ] ブラウザのキャッシュをクリアした
- [ ] GASエディタのログを確認した

## それでもエラーが出る場合

1. **新しいWebアプリデプロイを作成**
   - 「デプロイ」→「新しいデプロイ」
   - 種類で「ウェブアプリ」を選択
   - 新しいURLが生成されるので、それを使用

2. **スプレッドシートIDを再確認**
   - スプレッドシートのURLからIDを確認
   - `Code.gs` の `SPREADSHEET_ID` が正しいか確認

3. **GASエディタで直接テスト**
   - GASエディタで「実行」→「getTasks」を選択
   - 実行してエラーが出るか確認
   - エラーが出る場合は、権限の問題です

